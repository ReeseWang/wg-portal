import{d as M,a as y,A as w,b as D,u as A,c as U,r as N,w as O,o as r,e as B,f as S,_ as W,g as x,h as d,i as e,t as l,j as v,v as b,k as _,l as L,m as k,F as C,n as F,s as T,p as R,q as z,x as f,y as E,z as G}from"./index-96214b1b.js";const P="/user",V=M({id:"users",state:()=>({userPeers:[],users:[],filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{Find:s=>o=>s.users.find(u=>u.Identifier===o),Count:s=>s.users.length,FilteredCount:s=>s.Filtered.length,All:s=>s.users,Peers:s=>s.userPeers,Filtered:s=>s.filter?s.users.filter(o=>o.Firstname.includes(s.filter)||o.Lastname.includes(s.filter)||o.Email.includes(s.filter)||o.Identifier.includes(s.filter)):s.users,FilteredAndPaged:s=>s.Filtered.slice(s.pageOffset,s.pageOffset+s.pageSize),isFetching:s=>s.fetching,hasNextPage:s=>s.pageOffset<s.FilteredCount-s.pageSize,hasPrevPage:s=>s.pageOffset>0,currentPage:s=>s.pageOffset/s.pageSize+1},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let s=1;this.pages=[];for(let o=0;o<this.FilteredCount;o+=this.pageSize)this.pages.push(s++)},gotoPage(s){this.pageOffset=(s-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setUsers(s){this.users=s,this.calculatePages(),this.fetching=!1},setUserPeers(s){this.userPeers=s,this.fetching=!1},async LoadUsers(){return this.fetching=!0,y.get(`${P}/all`).then(this.setUsers).catch(s=>{this.setUsers([]),console.log("Failed to load users: ",s),w({title:"Backend Connection Failure",text:"Failed to load users!"})})},async DeleteUser(s){return this.fetching=!0,y.delete(`${P}/${D(s)}`).then(()=>{this.users=this.users.filter(o=>o.Identifier!==s),this.fetching=!1}).catch(o=>{throw this.fetching=!1,console.log(o),new Error(o)})},async UpdateUser(s,o){return this.fetching=!0,y.put(`${P}/${D(s)}`,o).then(u=>{let g=this.users.findIndex(c=>c.Identifier===s);this.users[g]=u,this.fetching=!1}).catch(u=>{throw this.fetching=!1,console.log(u),new Error(u)})},async CreateUser(s){return this.fetching=!0,y.post(`${P}/new`,s).then(o=>{this.users.push(o),this.fetching=!1}).catch(o=>{throw this.fetching=!1,console.log(o),new Error(o)})},async LoadUserPeers(s){return this.fetching=!0,y.get(`${P}/${D(s)}/peers`).then(this.setUserPeers).catch(o=>{this.setUserPeers([]),console.log("Failed to load user peers for ",s,": ",o),w({title:"Backend Connection Failure",text:"Failed to load user peers!"})})}}}),H={key:0},j=e("legend",{class:"mt-4"},"General",-1),q={key:0,class:"form-group"},K={class:"form-label mt-4"},J={class:"form-group"},Q={class:"form-label mt-4"},X={key:1,class:"form-group"},Y={class:"form-label mt-4"},Z={key:0,id:"passwordHelp",class:"form-text text-muted"},ee={key:1},se=e("legend",{class:"mt-4"},"User Information",-1),te={class:"form-group"},le={class:"form-label mt-4"},oe={class:"row"},ae={class:"form-group col-md-6"},ne={class:"form-label mt-4"},ie={class:"form-group col-md-6"},re={class:"form-label mt-4"},de={class:"row"},ue={class:"form-group col-md-6"},ce={class:"form-label mt-4"},he={class:"form-group col-md-6"},pe={class:"form-label mt-4"},fe=e("legend",{class:"mt-4"},"Notes",-1),me={class:"form-group"},_e={class:"form-label mt-4"},ve=e("legend",{class:"mt-4"},"State",-1),ge={class:"form-check form-switch"},be=e("label",{class:"form-check-label"},"Disabled (no WireGuard connection and no login possible)",-1),$e={class:"form-check form-switch"},ke=e("label",{class:"form-check-label"},"Locked (no login possible, WireGuard connections still work)",-1),ye={key:0,class:"form-check form-switch"},Pe=e("label",{class:"form-check-label"},"Is Admin",-1),Ue={class:"flex-fill text-start"},Ce=["onClick"],Ie=["onClick"],we=["onClick"],Se={__name:"UserEditModal",props:{userId:String,visible:Boolean},emits:["close"],setup(s,{emit:o}){const u=s,{t:g}=A(),c=V(),a=U(()=>c.Find(u.userId)),n=U(()=>u.visible?a.value?g("users.edit")+": "+a.value.Identifier:g("users.new"):""),t=N(x());O(()=>u.visible,async(p,i)=>{i===!1&&p===!0&&(a.value?(t.value.Identifier=a.value.Identifier,t.value.Email=a.value.Email,t.value.Source=a.value.Source,t.value.IsAdmin=a.value.IsAdmin,t.value.Firstname=a.value.Firstname,t.value.Lastname=a.value.Lastname,t.value.Phone=a.value.Phone,t.value.Department=a.value.Department,t.value.Notes=a.value.Notes,t.value.Password="",t.value.Disabled=a.value.Disabled):t.value=x())});function $(){t.value=x(),o("close")}async function m(){try{u.userId!=="#NEW#"?await c.UpdateUser(a.value.Identifier,t.value):await c.CreateUser(t.value),$()}catch(p){w({title:"Failed to save user!",text:p.toString(),type:"error"})}}async function I(){try{await c.DeleteUser(a.value.Identifier),$()}catch(p){w({title:"Failed to delete user!",text:p.toString(),type:"error"})}}return(p,i)=>(r(),B(W,{title:n.value,visible:s.visible,onClose:$},{default:S(()=>[t.value.Source==="db"?(r(),d("fieldset",H,[j,u.userId==="#NEW#"?(r(),d("div",q,[e("label",K,l(p.$t("modals.useredit.identifier")),1),v(e("input",{"onUpdate:modelValue":i[0]||(i[0]=h=>t.value.Identifier=h),class:"form-control",placeholder:"The user id",type:"text"},null,512),[[b,t.value.Identifier]])])):_("",!0),e("div",J,[e("label",Q,l(p.$t("modals.useredit.source")),1),v(e("input",{"onUpdate:modelValue":i[1]||(i[1]=h=>t.value.Source=h),class:"form-control",disabled:"disabled",placeholder:"The user source",type:"text"},null,512),[[b,t.value.Source]])]),t.value.Source==="db"?(r(),d("div",X,[e("label",Y,l(p.$t("modals.useredit.password")),1),v(e("input",{"onUpdate:modelValue":i[2]||(i[2]=h=>t.value.Password=h),"aria-describedby":"passwordHelp",class:"form-control",placeholder:"Password",type:"text"},null,512),[[b,t.value.Password]]),u.userId!=="#NEW#"?(r(),d("small",Z,"Leave this field blank to keep current password.")):_("",!0)])):_("",!0)])):_("",!0),t.value.Source==="db"?(r(),d("fieldset",ee,[se,e("div",te,[e("label",le,l(p.$t("modals.useredit.email")),1),v(e("input",{"onUpdate:modelValue":i[3]||(i[3]=h=>t.value.Email=h),class:"form-control",placeholder:"Email",type:"email"},null,512),[[b,t.value.Email]])]),e("div",oe,[e("div",ae,[e("label",ne,l(p.$t("modals.useredit.firstname")),1),v(e("input",{"onUpdate:modelValue":i[4]||(i[4]=h=>t.value.Firstname=h),class:"form-control",placeholder:"Firstname",type:"text"},null,512),[[b,t.value.Firstname]])]),e("div",ie,[e("label",re,l(p.$t("modals.useredit.lastname")),1),v(e("input",{"onUpdate:modelValue":i[5]||(i[5]=h=>t.value.Lastname=h),class:"form-control",placeholder:"Lastname",type:"text"},null,512),[[b,t.value.Lastname]])])]),e("div",de,[e("div",ue,[e("label",ce,l(p.$t("modals.useredit.phone")),1),v(e("input",{"onUpdate:modelValue":i[6]||(i[6]=h=>t.value.Phone=h),class:"form-control",placeholder:"Phone",type:"text"},null,512),[[b,t.value.Phone]])]),e("div",he,[e("label",pe,l(p.$t("modals.useredit.department")),1),v(e("input",{"onUpdate:modelValue":i[7]||(i[7]=h=>t.value.Department=h),class:"form-control",placeholder:"Department",type:"text"},null,512),[[b,t.value.Department]])])])])):_("",!0),e("fieldset",null,[fe,e("div",me,[e("label",_e,l(p.$t("modals.useredit.notes")),1),v(e("textarea",{"onUpdate:modelValue":i[8]||(i[8]=h=>t.value.Notes=h),class:"form-control",rows:"2"},null,512),[[b,t.value.Notes]])])]),e("fieldset",null,[ve,e("div",ge,[v(e("input",{"onUpdate:modelValue":i[9]||(i[9]=h=>t.value.Disabled=h),class:"form-check-input",type:"checkbox"},null,512),[[L,t.value.Disabled]]),be]),e("div",$e,[v(e("input",{"onUpdate:modelValue":i[10]||(i[10]=h=>t.value.Locked=h),class:"form-check-input",type:"checkbox"},null,512),[[L,t.value.Locked]]),ke]),t.value.Source==="db"?(r(),d("div",ye,[v(e("input",{"onUpdate:modelValue":i[11]||(i[11]=h=>t.value.IsAdmin=h),checked:"",class:"form-check-input",type:"checkbox"},null,512),[[L,t.value.IsAdmin]]),Pe])):_("",!0)])]),footer:S(()=>[e("div",Ue,[u.userId!=="#NEW#"&&t.value.Source==="db"?(r(),d("button",{key:0,class:"btn btn-danger me-1",type:"button",onClick:k(I,["prevent"])},"Delete",8,Ce)):_("",!0)]),e("button",{class:"btn btn-primary me-1",type:"button",onClick:k(m,["prevent"])},"Save",8,Ie),e("button",{class:"btn btn-secondary",type:"button",onClick:k($,["prevent"])},"Discard",8,we)]),_:1},8,["title","visible"]))}},Fe=e("ul",{class:"nav nav-tabs"},[e("li",{class:"nav-item"},[e("a",{class:"nav-link active","data-bs-toggle":"tab",href:"#user"},"User")]),e("li",{class:"nav-item"},[e("a",{class:"nav-link","data-bs-toggle":"tab",href:"#peers"},"Peers")])],-1),De={id:"interfaceTabs",class:"tab-content"},xe={id:"user",class:"tab-pane fade active show"},Le={class:"list-group list-group-flush"},Ee={class:"list-group-item"},Ne=e("h4",null,"User Information:",-1),Ve={class:"table table-sm table-borderless device-status-table"},ze={key:0},Ae={key:1},Oe={key:0,class:"list-group-item"},Be=e("h4",null,"Notes:",-1),We={class:"table table-sm table-borderless device-status-table"},Me={id:"peers",class:"tab-pane fade"},Te={key:0,class:"list-group list-group-flush"},Re={class:"list-group-item"},Ge={key:1,id:"peerTable",class:"table table-sm"},He={scope:"col"},je={scope:"col"},qe={scope:"col"},Ke=e("th",{scope:"col"},null,-1),Je=["onClick"],Qe={__name:"UserViewModal",props:{userId:String,visible:Boolean},emits:["close"],setup(s,{emit:o}){const u=s,{t:g}=A(),c=V(),a=U(()=>{let m=c.Find(u.userId);return m||{}}),n=U(()=>u.visible?g("users.view")+": "+a.value.Identifier:""),t=U(()=>c.Peers);O(()=>u.visible,async(m,I)=>{I===!1&&m===!0&&await c.LoadUserPeers(a.value.Identifier)});function $(){o("close")}return(m,I)=>(r(),B(W,{title:n.value,visible:s.visible,onClose:$},{default:S(()=>[Fe,e("div",De,[e("div",xe,[e("ul",Le,[e("li",Ee,[Ne,e("table",Ve,[e("tbody",null,[e("tr",null,[e("td",null,l(m.$t("users.label.email"))+":",1),e("td",null,l(a.value.Email),1)]),e("tr",null,[e("td",null,l(m.$t("users.label.firstname"))+":",1),e("td",null,l(a.value.Firstname),1)]),e("tr",null,[e("td",null,l(m.$t("users.label.lastname"))+":",1),e("td",null,l(a.value.Lastname),1)]),e("tr",null,[e("td",null,l(m.$t("users.label.phone"))+":",1),e("td",null,l(a.value.Phone),1)]),e("tr",null,[e("td",null,l(m.$t("users.label.department"))+":",1),e("td",null,l(a.value.Department),1)]),a.value.Disabled?(r(),d("tr",ze,[e("td",null,l(m.$t("users.label.disabled"))+":",1),e("td",null,l(a.value.DisabledReason),1)])):_("",!0),a.value.Locked?(r(),d("tr",Ae,[e("td",null,l(m.$t("users.label.locked"))+":",1),e("td",null,l(a.value.LockedReason),1)])):_("",!0)])])]),a.value.Notes?(r(),d("li",Oe,[Be,e("table",We,[e("tbody",null,[e("tr",null,[e("td",null,l(a.value.Notes),1)])])])])):_("",!0)])]),e("div",Me,[t.value.length===0?(r(),d("ul",Te,[e("li",Re,l(m.$t("users.nopeers.message")),1)])):_("",!0),t.value.length!==0?(r(),d("table",Ge,[e("thead",null,[e("tr",null,[e("th",He,l(m.$t("user.peers.name")),1),e("th",je,l(m.$t("user.peers.interface")),1),e("th",qe,l(m.$t("user.peers.ips")),1),Ke])]),e("tbody",null,[(r(!0),d(C,null,F(t.value,p=>(r(),d("tr",{key:p.Identifier},[e("td",null,l(p.DisplayName),1),e("td",null,l(p.InterfaceIdentifier),1),e("td",null,[(r(!0),d(C,null,F(p.Addresses,i=>(r(),d("span",{key:i,class:"badge rounded-pill bg-light"},l(i),1))),128))])]))),128))])])):_("",!0)])])]),footer:S(()=>[e("button",{class:"btn btn-primary",type:"button",onClick:k($,["prevent"])},"Close",8,Je)]),_:1},8,["title","visible"]))}},Xe={class:"mt-4 row"},Ye={class:"col-12 col-lg-5"},Ze={class:"col-12 col-lg-4 text-lg-end"},es={class:"form-group d-inline"},ss={class:"input-group mb-3"},ts=e("button",{class:"input-group-text btn btn-primary",title:"Search"},[e("i",{class:"fa-solid fa-search"})],-1),ls={class:"col-12 col-lg-3 text-lg-end"},os=e("i",{class:"fa fa-plus me-1"},null,-1),as=e("i",{class:"fa fa-user"},null,-1),ns=[os,as],is={class:"mt-2 table-responsive"},rs={key:0},ds={key:1,id:"userTable",class:"table table-sm"},us=e("th",{scope:"col"},[e("input",{id:"flexCheckDefault",class:"form-check-input",title:"Select all",type:"checkbox",value:""})],-1),cs=e("th",{scope:"col"},null,-1),hs={scope:"col"},ps={scope:"col"},fs={scope:"col"},ms={scope:"col"},_s={class:"text-center",scope:"col"},vs={class:"text-center",scope:"col"},gs={class:"text-center",scope:"col"},bs=e("th",{scope:"col"},null,-1),$s=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),ks={class:"text-center"},ys={key:0,class:"text-danger"},Ps=["title"],Us={key:1,class:"text-danger"},Cs=["title"],Is={class:"text-center"},ws={class:"badge rounded-pill bg-light"},Ss={class:"text-center"},Fs={class:"text-center"},Ds={key:0,class:"text-danger"},xs=e("i",{class:"fa fa-check-circle"},null,-1),Ls=[xs],Es={key:1},Ns=e("i",{class:"fa fa-circle-xmark"},null,-1),Vs=[Ns],zs={class:"text-center"},As=["onClick"],Os=e("i",{class:"fas fa-eye me-2"},null,-1),Bs=[Os],Ws=["onClick"],Ms=e("i",{class:"fas fa-cog me-2"},null,-1),Ts=[Ms],Rs=e("hr",null,null,-1),Gs={class:"mt-3"},Hs={class:"row"},js={class:"col-6"},qs={class:"pagination pagination-sm"},Ks=["onClick"],Js={class:"col-6"},Qs={class:"form-group row"},Xs={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},Ys={class:"col-sm-6"},Zs=e("option",{value:"10"},"10",-1),et=e("option",{value:"25"},"25",-1),st=e("option",{value:"50"},"50",-1),tt=e("option",{value:"100"},"100",-1),lt={value:"999999999"},at={__name:"UserView",setup(s){T();const o=V(),u=N(""),g=N("");return R(()=>{o.LoadUsers()}),(c,a)=>(r(),d(C,null,[z(Se,{userId:u.value,visible:u.value!=="",onClose:a[0]||(a[0]=n=>u.value="")},null,8,["userId","visible"]),z(Qe,{userId:g.value,visible:g.value!=="",onClose:a[1]||(a[1]=n=>g.value="")},null,8,["userId","visible"]),e("div",Xe,[e("div",Ye,[e("h1",null,l(c.$t("user.h1")),1)]),e("div",Ze,[e("div",es,[e("div",ss,[v(e("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>f(o).filter=n),class:"form-control",placeholder:"Search...",type:"text",onKeyup:a[3]||(a[3]=(...n)=>f(o).afterPageSizeChange&&f(o).afterPageSizeChange(...n))},null,544),[[b,f(o).filter]]),ts])])]),e("div",ls,[e("a",{class:"btn btn-primary ms-2",href:"#",title:"Add a user",onClick:a[4]||(a[4]=k(n=>u.value="#NEW#",["prevent"]))},ns)])]),e("div",is,[f(o).Count===0?(r(),d("div",rs,[e("h4",null,l(c.$t("users.noUsers.h4")),1),e("p",null,l(c.$t("users.noUsers.message")),1)])):_("",!0),f(o).Count!==0?(r(),d("table",ds,[e("thead",null,[e("tr",null,[us,cs,e("th",hs,l(c.$t("user.id")),1),e("th",ps,l(c.$t("user.email")),1),e("th",fs,l(c.$t("user.firstname")),1),e("th",ms,l(c.$t("user.lastname")),1),e("th",_s,l(c.$t("user.source")),1),e("th",vs,l(c.$t("user.peers")),1),e("th",gs,l(c.$t("user.admin")),1),bs])]),e("tbody",null,[(r(!0),d(C,null,F(f(o).FilteredAndPaged,n=>(r(),d("tr",{key:n.Identifier},[$s,e("td",ks,[n.Disabled?(r(),d("span",ys,[e("i",{class:"fa fa-circle-xmark",title:n.DisabledReason},null,8,Ps)])):_("",!0),n.Locked?(r(),d("span",Us,[e("i",{class:"fas fa-lock",title:n.LockedReason},null,8,Cs)])):_("",!0)]),e("td",null,l(n.Identifier),1),e("td",null,l(n.Email),1),e("td",null,l(n.Firstname),1),e("td",null,l(n.Lastname),1),e("td",Is,[e("span",ws,l(n.Source),1)]),e("td",Ss,l(n.PeerCount),1),e("td",Fs,[n.IsAdmin?(r(),d("span",Ds,Ls)):(r(),d("span",Es,Vs))]),e("td",zs,[e("a",{href:"#",title:"Show user",onClick:k(t=>g.value=n.Identifier,["prevent"])},Bs,8,As),e("a",{href:"#",title:"Edit user",onClick:k(t=>u.value=n.Identifier,["prevent"])},Ts,8,Ws)])]))),128))])])):_("",!0)]),Rs,e("div",Gs,[e("div",Hs,[e("div",js,[e("ul",qs,[e("li",{class:E([{disabled:f(o).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:a[5]||(a[5]=(...n)=>f(o).previousPage&&f(o).previousPage(...n))},"«")],2),(r(!0),d(C,null,F(f(o).pages,n=>(r(),d("li",{key:n,class:E([{active:f(o).currentPage===n},"page-item"])},[e("a",{class:"page-link",onClick:t=>f(o).gotoPage(n)},l(n),9,Ks)],2))),128)),e("li",{class:E([{disabled:!f(o).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:a[6]||(a[6]=(...n)=>f(o).nextPage&&f(o).nextPage(...n))},"»")],2)])]),e("div",Js,[e("div",Qs,[e("label",Xs,l(c.$t("general.pagination.size"))+":",1),e("div",Ys,[v(e("select",{"onUpdate:modelValue":a[7]||(a[7]=n=>f(o).pageSize=n),class:"form-select",onClick:a[8]||(a[8]=n=>f(o).afterPageSizeChange())},[Zs,et,st,tt,e("option",lt,l(c.$t("general.pagination.all")),1)],512),[[G,f(o).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{at as default};
