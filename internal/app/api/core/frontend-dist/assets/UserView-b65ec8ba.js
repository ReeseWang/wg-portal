import{d as W,a as P,A as w,b as E,u as O,c as C,r as N,w as B,o as u,e as M,f as D,_ as T,g as e,h as p,t as o,i as m,v as g,j as $,k as z,l as k,m as L,F as U,n as x,p as H,q as A,s as h,x as F,y as j}from"./index-01f1dd15.js";const I="/user",V=W({id:"users",state:()=>({userPeers:[],users:[],filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{Find:t=>l=>t.users.find(n=>n.Identifier===l),Count:t=>t.users.length,FilteredCount:t=>t.Filtered.length,All:t=>t.users,Peers:t=>t.userPeers,Filtered:t=>t.filter?t.users.filter(l=>l.Firstname.includes(t.filter)||l.Lastname.includes(t.filter)||l.Email.includes(t.filter)||l.Identifier.includes(t.filter)):t.users,FilteredAndPaged:t=>t.Filtered.slice(t.pageOffset,t.pageOffset+t.pageSize),isFetching:t=>t.fetching,hasNextPage:t=>t.pageOffset<t.FilteredCount-t.pageSize,hasPrevPage:t=>t.pageOffset>0,currentPage:t=>t.pageOffset/t.pageSize+1},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let t=1;this.pages=[];for(let l=0;l<this.FilteredCount;l+=this.pageSize)this.pages.push(t++)},gotoPage(t){this.pageOffset=(t-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setUsers(t){this.users=t,this.calculatePages(),this.fetching=!1},setUserPeers(t){this.userPeers=t,this.fetching=!1},async LoadUsers(){return this.fetching=!0,P.get(`${I}/all`).then(this.setUsers).catch(t=>{this.setUsers([]),console.log("Failed to load users: ",t),w({title:"Backend Connection Failure",text:"Failed to load users!"})})},async DeleteUser(t){return this.fetching=!0,P.delete(`${I}/${E(t)}`).then(()=>{this.users=this.users.filter(l=>l.Identifier!==t),this.fetching=!1}).catch(l=>{throw this.fetching=!1,console.log(l),new Error(l)})},async UpdateUser(t,l){return this.fetching=!0,P.put(`${I}/${E(t)}`,l).then(n=>{let _=this.users.findIndex(v=>v.Identifier===t);this.users[_]=n,this.fetching=!1}).catch(n=>{throw this.fetching=!1,console.log(n),new Error(n)})},async CreateUser(t){return this.fetching=!0,P.post(`${I}/new`,t).then(l=>{this.users.push(l),this.fetching=!1}).catch(l=>{throw this.fetching=!1,console.log(l),new Error(l)})},async LoadUserPeers(t){return this.fetching=!0,P.get(`${I}/${E(t)}/peers`).then(this.setUserPeers).catch(l=>{this.setUserPeers([]),console.log("Failed to load user peers for ",t,": ",l),w({title:"Backend Connection Failure",text:"Failed to load user peers!"})})}}}),q=e("legend",{class:"mt-4"},"General",-1),G={key:0,class:"form-group"},K={class:"form-label mt-4"},Y={class:"form-group"},J={class:"form-label mt-4"},Q={key:1,class:"form-group"},R={class:"form-label mt-4"},X={key:0,id:"passwordHelp",class:"form-text text-muted"},Z=e("legend",{class:"mt-4"},"User Information",-1),ee={class:"form-group"},se={class:"form-label mt-4"},te={class:"row"},le={class:"form-group col-md-6"},oe={class:"form-label mt-4"},ae={class:"form-group col-md-6"},ne={class:"form-label mt-4"},ie={class:"row"},re={class:"form-group col-md-6"},de={class:"form-label mt-4"},ue={class:"form-group col-md-6"},ce={class:"form-label mt-4"},he=e("legend",{class:"mt-4"},"Notes",-1),pe={class:"form-group"},fe={class:"form-label mt-4"},me=e("legend",{class:"mt-4"},"State",-1),ve={class:"form-check form-switch"},_e=e("label",{class:"form-check-label"},"Disabled",-1),ge={class:"form-check form-switch"},be=e("label",{class:"form-check-label"},"Is Admin",-1),$e={class:"flex-fill text-start"},ke=["onClick"],ye=["onClick"],Pe=["onClick"],Ie={__name:"UserEditModal",props:{userId:String,visible:Boolean},emits:["close"],setup(t,{emit:l}){const n=t,{t:_}=O(),v=V(),a=C(()=>v.Find(n.userId)),r=C(()=>n.visible?a.value?_("users.edit")+": "+a.value.Identifier:_("users.new"):""),s=N(b());function b(){return{Identifier:"",Email:"",Source:"db",IsAdmin:!1,Firstname:"",Lastname:"",Phone:"",Department:"",Notes:"",Password:"",Disabled:!1}}B(()=>n.visible,async(f,i)=>{i===!1&&f===!0&&(a.value?(s.value.Identifier=a.value.Identifier,s.value.Email=a.value.Email,s.value.Source=a.value.Source,s.value.IsAdmin=a.value.IsAdmin,s.value.Firstname=a.value.Firstname,s.value.Lastname=a.value.Lastname,s.value.Phone=a.value.Phone,s.value.Department=a.value.Department,s.value.Notes=a.value.Notes,s.value.Password="",s.value.Disabled=a.value.Disabled):s.value=b())});function c(){s.value=b(),l("close")}async function S(){try{n.userId!=="#NEW#"?await v.UpdateUser(a.value.Identifier,s.value):await v.CreateUser(s.value),c()}catch(f){w({title:"Failed to save user!",text:f.toString(),type:"error"})}}async function y(){try{await v.DeleteUser(a.value.Identifier),c()}catch(f){w({title:"Failed to delete user!",text:f.toString(),type:"error"})}}return(f,i)=>(u(),M(T,{title:r.value,visible:t.visible,onClose:c},{default:D(()=>[e("fieldset",null,[q,n.userId==="#NEW#"?(u(),p("div",G,[e("label",K,o(f.$t("modals.useredit.identifier")),1),m(e("input",{"onUpdate:modelValue":i[0]||(i[0]=d=>s.value.Identifier=d),class:"form-control",placeholder:"The user id",type:"text"},null,512),[[g,s.value.Identifier]])])):$("",!0),e("div",Y,[e("label",J,o(f.$t("modals.useredit.source")),1),m(e("input",{"onUpdate:modelValue":i[1]||(i[1]=d=>s.value.Source=d),class:"form-control",disabled:"disabled",placeholder:"The user source",type:"text"},null,512),[[g,s.value.Source]])]),s.value.Source==="db"?(u(),p("div",Q,[e("label",R,o(f.$t("modals.useredit.password")),1),m(e("input",{"onUpdate:modelValue":i[2]||(i[2]=d=>s.value.Password=d),"aria-describedby":"passwordHelp",class:"form-control",placeholder:"Password",type:"text"},null,512),[[g,s.value.Password]]),n.userId!=="#NEW#"?(u(),p("small",X,"Leave this field blank to keep current password.")):$("",!0)])):$("",!0)]),e("fieldset",null,[Z,e("div",ee,[e("label",se,o(f.$t("modals.useredit.email")),1),m(e("input",{"onUpdate:modelValue":i[3]||(i[3]=d=>s.value.Email=d),class:"form-control",placeholder:"Email",type:"email"},null,512),[[g,s.value.Email]])]),e("div",te,[e("div",le,[e("label",oe,o(f.$t("modals.useredit.firstname")),1),m(e("input",{"onUpdate:modelValue":i[4]||(i[4]=d=>s.value.Firstname=d),class:"form-control",placeholder:"Firstname",type:"text"},null,512),[[g,s.value.Firstname]])]),e("div",ae,[e("label",ne,o(f.$t("modals.useredit.lastname")),1),m(e("input",{"onUpdate:modelValue":i[5]||(i[5]=d=>s.value.Lastname=d),class:"form-control",placeholder:"Lastname",type:"text"},null,512),[[g,s.value.Lastname]])])]),e("div",ie,[e("div",re,[e("label",de,o(f.$t("modals.useredit.phone")),1),m(e("input",{"onUpdate:modelValue":i[6]||(i[6]=d=>s.value.Phone=d),class:"form-control",placeholder:"Phone",type:"text"},null,512),[[g,s.value.Phone]])]),e("div",ue,[e("label",ce,o(f.$t("modals.useredit.department")),1),m(e("input",{"onUpdate:modelValue":i[7]||(i[7]=d=>s.value.Department=d),class:"form-control",placeholder:"Department",type:"text"},null,512),[[g,s.value.Department]])])])]),e("fieldset",null,[he,e("div",pe,[e("label",fe,o(f.$t("modals.useredit.notes")),1),m(e("textarea",{"onUpdate:modelValue":i[8]||(i[8]=d=>s.value.Notes=d),class:"form-control",rows:"2"},null,512),[[g,s.value.Notes]])])]),e("fieldset",null,[me,e("div",ve,[m(e("input",{"onUpdate:modelValue":i[9]||(i[9]=d=>s.value.Disabled=d),class:"form-check-input",type:"checkbox"},null,512),[[z,s.value.Disabled]]),_e]),e("div",ge,[m(e("input",{"onUpdate:modelValue":i[10]||(i[10]=d=>s.value.IsAdmin=d),checked:"",class:"form-check-input",type:"checkbox"},null,512),[[z,s.value.IsAdmin]]),be])])]),footer:D(()=>[e("div",$e,[n.userId!=="#NEW#"?(u(),p("button",{key:0,class:"btn btn-danger me-1",type:"button",onClick:k(y,["prevent"])},"Delete",8,ke)):$("",!0)]),e("button",{class:"btn btn-primary me-1",type:"button",onClick:k(S,["prevent"])},"Save",8,ye),e("button",{class:"btn btn-secondary",type:"button",onClick:k(c,["prevent"])},"Discard",8,Pe)]),_:1},8,["title","visible"]))}},Ce=e("ul",{class:"nav nav-tabs"},[e("li",{class:"nav-item"},[e("a",{class:"nav-link active","data-bs-toggle":"tab",href:"#user"},"User")]),e("li",{class:"nav-item"},[e("a",{class:"nav-link","data-bs-toggle":"tab",href:"#peers"},"Peers")])],-1),Ue={id:"interfaceTabs",class:"tab-content"},we={id:"user",class:"tab-pane fade active show"},Se={class:"list-group list-group-flush"},Fe={class:"list-group-item"},De={class:"table table-sm table-borderless device-status-table"},xe={class:"list-group-item"},Ee={class:"table table-sm table-borderless device-status-table"},Ne={id:"peers",class:"tab-pane fade"},Ve={key:0,class:"list-group list-group-flush"},ze={class:"list-group-item"},Le={key:1,id:"peerTable",class:"table table-sm"},Ae={scope:"col"},Oe={scope:"col"},Be={scope:"col"},Me=e("th",{scope:"col"},null,-1),Te=["onClick"],We={__name:"UserViewModal",props:{userId:String,visible:Boolean},emits:["close"],setup(t,{emit:l}){const n=t,{t:_}=O(),v=V(),a=C(()=>{let c=v.Find(n.userId);return c||{}}),r=C(()=>n.visible?_("users.view")+": "+a.value.Identifier:""),s=C(()=>v.Peers);B(()=>n.visible,async(c,S)=>{S===!1&&c===!0&&(console.log(a.value),await v.LoadUserPeers(a.value.Identifier))});function b(){l("close")}return(c,S)=>(u(),M(T,{title:r.value,visible:t.visible,onClose:b},{default:D(()=>[Ce,e("div",Ue,[e("div",we,[e("ul",Se,[e("li",Fe,[L(" User Information: "),e("table",De,[e("tbody",null,[e("tr",null,[e("td",null,o(c.$t("users.label.email"))+":",1),e("td",null,o(a.value.Email),1)]),e("tr",null,[e("td",null,o(c.$t("users.label.firstname"))+":",1),e("td",null,o(a.value.Firstname),1)]),e("tr",null,[e("td",null,o(c.$t("users.label.lastname"))+":",1),e("td",null,o(a.value.Lastname),1)]),e("tr",null,[e("td",null,o(c.$t("users.label.phone"))+":",1),e("td",null,o(a.value.Phone),1)]),e("tr",null,[e("td",null,o(c.$t("users.label.department"))+":",1),e("td",null,o(a.value.Department),1)])])])]),e("li",xe,[L(" Notes: "),e("table",Ee,[e("tbody",null,[e("tr",null,[e("td",null,o(a.value.Notes),1)])])])])])]),e("div",Ne,[s.value.length===0?(u(),p("ul",Ve,[e("li",ze,o(c.$t("users.nopeers.message")),1)])):$("",!0),s.value.length!==0?(u(),p("table",Le,[e("thead",null,[e("tr",null,[e("th",Ae,o(c.$t("user.peers.name")),1),e("th",Oe,o(c.$t("user.peers.interface")),1),e("th",Be,o(c.$t("user.peers.ips")),1),Me])]),e("tbody",null,[(u(!0),p(U,null,x(s.value,y=>(u(),p("tr",{key:y.Identifier},[e("td",null,o(y.DisplayName),1),e("td",null,o(y.InterfaceIdentifier),1),e("td",null,[(u(!0),p(U,null,x(y.Addresses,f=>(u(),p("span",{key:f,class:"badge rounded-pill bg-light"},o(f),1))),128))])]))),128))])])):$("",!0)])])]),footer:D(()=>[e("button",{class:"btn btn-primary",type:"button",onClick:k(b,["prevent"])},"Close",8,Te)]),_:1},8,["title","visible"]))}},He={class:"mt-4 row"},je={class:"col-12 col-lg-5"},qe={class:"col-12 col-lg-4 text-lg-end"},Ge={class:"form-group d-inline"},Ke={class:"input-group mb-3"},Ye=e("button",{class:"input-group-text btn btn-primary",title:"Search"},[e("i",{class:"fa-solid fa-search"})],-1),Je={class:"col-12 col-lg-3 text-lg-end"},Qe=e("i",{class:"fa fa-plus me-1"},null,-1),Re=e("i",{class:"fa fa-user"},null,-1),Xe=[Qe,Re],Ze={class:"mt-2 table-responsive"},es={key:0},ss={key:1,id:"userTable",class:"table table-sm"},ts=e("th",{scope:"col"},[e("input",{id:"flexCheckDefault",class:"form-check-input",title:"Select all",type:"checkbox",value:""})],-1),ls={scope:"col"},os={scope:"col"},as={scope:"col"},ns={scope:"col"},is={class:"text-center",scope:"col"},rs={class:"text-center",scope:"col"},ds={class:"text-center",scope:"col"},us=e("th",{scope:"col"},null,-1),cs=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),hs={class:"text-center"},ps={class:"badge rounded-pill bg-light"},fs={class:"text-center"},ms={class:"text-center"},vs={key:0,class:"text-danger"},_s=e("i",{class:"fa fa-check-circle"},null,-1),gs=[_s],bs={key:1},$s=e("i",{class:"fa fa-circle-xmark"},null,-1),ks=[$s],ys={class:"text-center"},Ps=["onClick"],Is=e("i",{class:"fas fa-eye me-2"},null,-1),Cs=[Is],Us=["onClick"],ws=e("i",{class:"fas fa-cog me-2"},null,-1),Ss=[ws],Fs=e("hr",null,null,-1),Ds={class:"mt-3"},xs={class:"row"},Es={class:"col-6"},Ns={class:"pagination pagination-sm"},Vs=["onClick"],zs={class:"col-6"},Ls={class:"form-group row"},As={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},Os={class:"col-sm-6"},Bs=e("option",{value:"10"},"10",-1),Ms=e("option",{value:"25"},"25",-1),Ts=e("option",{value:"50"},"50",-1),Ws=e("option",{value:"100"},"100",-1),Hs={value:"999999999"},qs={__name:"UserView",setup(t){const l=V(),n=N(""),_=N("");H(()=>{l.LoadUsers()});function v(a){a.Source==="db"?n.value=a.Identifier:w({title:"Forbidden",text:"You can not edit this user!",type:"error"})}return(a,r)=>(u(),p(U,null,[A(Ie,{userId:n.value,visible:n.value!=="",onClose:r[0]||(r[0]=s=>n.value="")},null,8,["userId","visible"]),A(We,{userId:_.value,visible:_.value!=="",onClose:r[1]||(r[1]=s=>_.value="")},null,8,["userId","visible"]),e("div",He,[e("div",je,[e("h1",null,o(a.$t("user.h1")),1)]),e("div",qe,[e("div",Ge,[e("div",Ke,[m(e("input",{"onUpdate:modelValue":r[2]||(r[2]=s=>h(l).filter=s),class:"form-control",placeholder:"Search...",type:"text",onKeyup:r[3]||(r[3]=(...s)=>h(l).afterPageSizeChange&&h(l).afterPageSizeChange(...s))},null,544),[[g,h(l).filter]]),Ye])])]),e("div",Je,[e("a",{class:"btn btn-primary ms-2",href:"#",title:"Add a user",onClick:r[4]||(r[4]=k(s=>n.value="#NEW#",["prevent"]))},Xe)])]),e("div",Ze,[h(l).Count===0?(u(),p("div",es,[e("h4",null,o(a.$t("users.noUsers.h4")),1),e("p",null,o(a.$t("users.noUsers.message")),1)])):$("",!0),h(l).Count!==0?(u(),p("table",ss,[e("thead",null,[e("tr",null,[ts,e("th",ls,o(a.$t("user.id")),1),e("th",os,o(a.$t("user.email")),1),e("th",as,o(a.$t("user.firstname")),1),e("th",ns,o(a.$t("user.lastname")),1),e("th",is,o(a.$t("user.source")),1),e("th",rs,o(a.$t("user.peers")),1),e("th",ds,o(a.$t("user.admin")),1),us])]),e("tbody",null,[(u(!0),p(U,null,x(h(l).FilteredAndPaged,s=>(u(),p("tr",{key:s.Identifier},[cs,e("td",null,o(s.Identifier),1),e("td",null,o(s.Email),1),e("td",null,o(s.Firstname),1),e("td",null,o(s.Lastname),1),e("td",hs,[e("span",ps,o(s.Source),1)]),e("td",fs,o(s.PeerCount),1),e("td",ms,[s.IsAdmin?(u(),p("span",vs,gs)):(u(),p("span",bs,ks))]),e("td",ys,[e("a",{href:"#",title:"Show user",onClick:k(b=>_.value=s.Identifier,["prevent"])},Cs,8,Ps),e("a",{class:F({disabled:s.Source!=="db"}),href:"#",title:"Edit user",onClick:k(b=>v(s),["prevent"])},Ss,10,Us)])]))),128))])])):$("",!0)]),Fs,e("div",Ds,[e("div",xs,[e("div",Es,[e("ul",Ns,[e("li",{class:F([{disabled:h(l).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:r[5]||(r[5]=(...s)=>h(l).previousPage&&h(l).previousPage(...s))},"«")],2),(u(!0),p(U,null,x(h(l).pages,s=>(u(),p("li",{key:s,class:F([{active:h(l).currentPage===s},"page-item"])},[e("a",{class:"page-link",onClick:b=>h(l).gotoPage(s)},o(s),9,Vs)],2))),128)),e("li",{class:F([{disabled:!h(l).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:r[6]||(r[6]=(...s)=>h(l).nextPage&&h(l).nextPage(...s))},"»")],2)])]),e("div",zs,[e("div",Ls,[e("label",As,o(a.$t("general.pagination.size"))+":",1),e("div",Os,[m(e("select",{"onUpdate:modelValue":r[7]||(r[7]=s=>h(l).pageSize=s),class:"form-select",onClick:r[8]||(r[8]=s=>h(l).afterPageSizeChange())},[Bs,Ms,Ts,Ws,e("option",Hs,o(a.$t("general.pagination.all")),1)],512),[[j,h(l).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{qs as default};
