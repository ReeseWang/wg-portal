import{d as T,a as P,A as w,u as A,c as U,r as E,w as O,o as u,b as B,e as x,f as n,_ as M,g as e,h,t as o,i as m,v as g,j as $,k as V,l as k,m as z,F as I,n as D,p as W,q as L,s as F,x as H}from "./index-62a1c0a6.js";const C="/user",N=T({id:"users",state:()=>({userPeers:[],users:[],filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{Find: t=> l=>t.users.find(i=>i.Identifier===l),Count: t=>t.users.length,FilteredCount: t=>t.Filtered.length,All: t=>t.users,Peers: t=>t.userPeers,Filtered: t=>t.filter?t.users.filter(l=>l.Firstname.includes(t.filter)||l.Lastname.includes(t.filter)||l.Email.includes(t.filter)||l.Identifier.includes(t.filter)):t.users,FilteredAndPaged: t=>t.Filtered.slice(t.pageOffset,t.pageOffset+t.pageSize),isFetching: t=>t.fetching,hasNextPage: t=>t.pageOffset<t.FilteredCount-t.pageSize,hasPrevPage: t=>t.pageOffset>0,currentPage: t=>t.pageOffset/t.pageSize+1},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let t=1;this.pages=[];for(let l=0; l<this.FilteredCount; l+=this.pageSize)this.pages.push(t++)},gotoPage(t){this.pageOffset=(t-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setUsers(t){this.users=t,this.calculatePages(),this.fetching=!1},setUserPeers(t){this.userPeers=t,this.fetching=!1},async LoadUsers(){return this.fetching=!0,P.get(`${C}/all`).then(this.setUsers).catch(t=>{this.setUsers([]),console.log("Failed to load users: ",t),w({title:"Backend Connection Failure",text:"Failed to load users!"})})},async DeleteUser(t){return this.fetching=!0,P.delete(`${C}/`+t).then(()=>{this.users=this.users.filter(l=>l.Identifier!==t),this.fetching=!1}).catch(l=>{throw this.fetching=!1,console.log(l),new Error(l)})},async UpdateUser(t, l){return this.fetching=!0,P.put(`${C}/`+t,l).then(i=>{let v=this.users.findIndex(_=>_.Identifier===t);this.users[v]=i,this.fetching=!1}).catch(i=>{throw this.fetching=!1,console.log(i),new Error(i)})},async CreateUser(t){return this.fetching=!0,P.post(`${C}/new`,t).then(l=>{this.users.push(l),this.fetching=!1}).catch(l=>{throw this.fetching=!1,console.log(l),new Error(l)})},async LoadUserPeers(t){return this.fetching=!0,P.get(`${C}/${t}/peers`).then(this.setUserPeers).catch(l=>{this.setUserPeers([]),console.log("Failed to load user peers for ",t,": ",l),w({title:"Backend Connection Failure",text:"Failed to load user peers!"})})}}}),j=e("legend",{class:"mt-4"},"General",-1),q={key:0,class:"form-group"},G={class:"form-label mt-4"},K={class:"form-group"},Y={class:"form-label mt-4"},J={key:1,class:"form-group"},Q={class:"form-label mt-4"},R={key:0,id:"passwordHelp",class:"form-text text-muted"},X=e("legend",{class:"mt-4"},"User Information",-1),Z={class:"form-group"},ee={class:"form-label mt-4"},se={class:"row"},te={class:"form-group col-md-6"},le={class:"form-label mt-4"},oe={class:"form-group col-md-6"},ae={class:"form-label mt-4"},ne={class:"row"},ie={class:"form-group col-md-6"},re={class:"form-label mt-4"},de={class:"form-group col-md-6"},ce={class:"form-label mt-4"},ue=e("legend",{class:"mt-4"},"Notes",-1),he={class:"form-group"},pe={class:"form-label mt-4"},fe=e("legend",{class:"mt-4"},"State",-1),me={class:"form-check form-switch"},_e=e("label",{class:"form-check-label"},"Disabled",-1),ve={class:"form-check form-switch"},ge=e("label",{class:"form-check-label"},"Is Admin",-1),be={class:"flex-fill text-start"},$e=["onClick"],ke=["onClick"],ye=["onClick"],Pe={__name:"UserEditModal",props:{userId:String,visible:Boolean},emits:["close"],setup(t, {emit:l}){const i=t,{t:v}=A(),_=N(),a=U(()=>_.Find(i.userId)),d=U(()=>i.visible?a.value?v("users.edit")+": "+a.value.Identifier:v("users.new"):""),s=E(b());function b(){return{Identifier:"",Email:"",Source:"db",IsAdmin:!1,Firstname:"",Lastname:"",Phone:"",Department:"",Notes:"",Password:"",Disabled:!1}}O(()=>i.visible,async(f, r)=>{r===!1&&f===!0&&(a.value?(s.value.Identifier=a.value.Identifier,s.value.Email=a.value.Email,s.value.Source=a.value.Source,s.value.IsAdmin=a.value.IsAdmin,s.value.Firstname=a.value.Firstname,s.value.Lastname=a.value.Lastname,s.value.Phone=a.value.Phone,s.value.Department=a.value.Department,s.value.Notes=a.value.Notes,s.value.Password="",s.value.Disabled=a.value.Disabled):s.value=b())});function p(){s.value=b(),l("close")}async function S(){try{i.userId!=="#NEW#"?await _.UpdateUser(a.value.Identifier,s.value):await _.CreateUser(s.value),p()}catch{w({title:"Backend Connection Failure",text:"Failed to save user!",type:"error"})}}async function y(){try{await _.DeleteUser(a.value.Identifier),p()}catch{w({title:"Backend Connection Failure",text:"Failed to delete user!",type:"error"})}}return(f, r)=>(u(),B(M,{title:n(d),visible:t.visible,onClose:p},{default:x(()=>[e("fieldset",null,[j,i.userId==="#NEW#"?(u(),h("div",q,[e("label",G,o(f.$t("modals.useredit.identifier")),1),m(e("input",{"onUpdate:modelValue":r[0]||(r[0]= c=>s.value.Identifier=c),class:"form-control",placeholder:"The user id",type:"text"},null,512),[[g,s.value.Identifier]])])):$("",!0),e("div",K,[e("label",Y,o(f.$t("modals.useredit.source")),1),m(e("input",{"onUpdate:modelValue":r[1]||(r[1]= c=>s.value.Source=c),class:"form-control",disabled:"disabled",placeholder:"The user source",type:"text"},null,512),[[g,s.value.Source]])]),s.value.Source==="db"?(u(),h("div",J,[e("label",Q,o(f.$t("modals.useredit.password")),1),m(e("input",{"onUpdate:modelValue":r[2]||(r[2]= c=>s.value.Password=c),"aria-describedby":"passwordHelp",class:"form-control",placeholder:"Password",type:"text"},null,512),[[g,s.value.Password]]),i.userId!=="#NEW#"?(u(),h("small",R,"Leave this field blank to keep current password.")):$("",!0)])):$("",!0)]),e("fieldset",null,[X,e("div",Z,[e("label",ee,o(f.$t("modals.useredit.email")),1),m(e("input",{"onUpdate:modelValue":r[3]||(r[3]= c=>s.value.Email=c),class:"form-control",placeholder:"Email",type:"email"},null,512),[[g,s.value.Email]])]),e("div",se,[e("div",te,[e("label",le,o(f.$t("modals.useredit.firstname")),1),m(e("input",{"onUpdate:modelValue":r[4]||(r[4]= c=>s.value.Firstname=c),class:"form-control",placeholder:"Firstname",type:"text"},null,512),[[g,s.value.Firstname]])]),e("div",oe,[e("label",ae,o(f.$t("modals.useredit.lastname")),1),m(e("input",{"onUpdate:modelValue":r[5]||(r[5]= c=>s.value.Lastname=c),class:"form-control",placeholder:"Lastname",type:"text"},null,512),[[g,s.value.Lastname]])])]),e("div",ne,[e("div",ie,[e("label",re,o(f.$t("modals.useredit.phone")),1),m(e("input",{"onUpdate:modelValue":r[6]||(r[6]= c=>s.value.Phone=c),class:"form-control",placeholder:"Phone",type:"text"},null,512),[[g,s.value.Phone]])]),e("div",de,[e("label",ce,o(f.$t("modals.useredit.department")),1),m(e("input",{"onUpdate:modelValue":r[7]||(r[7]= c=>s.value.Department=c),class:"form-control",placeholder:"Department",type:"text"},null,512),[[g,s.value.Department]])])])]),e("fieldset",null,[ue,e("div",he,[e("label",pe,o(f.$t("modals.useredit.notes")),1),m(e("textarea",{"onUpdate:modelValue":r[8]||(r[8]= c=>s.value.Notes=c),class:"form-control",rows:"2"},null,512),[[g,s.value.Notes]])])]),e("fieldset",null,[fe,e("div",me,[m(e("input",{"onUpdate:modelValue":r[9]||(r[9]= c=>s.value.Disabled=c),class:"form-check-input",type:"checkbox"},null,512),[[V,s.value.Disabled]]),_e]),e("div",ve,[m(e("input",{"onUpdate:modelValue":r[10]||(r[10]= c=>s.value.IsAdmin=c),checked:"",class:"form-check-input",type:"checkbox"},null,512),[[V,s.value.IsAdmin]]),ge])])]),footer:x(()=>[e("div",be,[i.userId!=="#NEW#"?(u(),h("button",{key:0,class:"btn btn-danger me-1",type:"button",onClick:k(y,["prevent"])},"Delete",8,$e)):$("",!0)]),e("button",{class:"btn btn-primary me-1",type:"button",onClick:k(S,["prevent"])},"Save",8,ke),e("button",{class:"btn btn-secondary",type:"button",onClick:k(p,["prevent"])},"Discard",8,ye)]),_:1},8,["title","visible"]))}},Ce=e("ul",{class:"nav nav-tabs"},[e("li",{class:"nav-item"},[e("a",{class:"nav-link active","data-bs-toggle":"tab",href:"#user"},"User")]),e("li",{class:"nav-item"},[e("a",{class:"nav-link","data-bs-toggle":"tab",href:"#peers"},"Peers")])],-1),Ue={id:"interfaceTabs",class:"tab-content"},Ie={id:"user",class:"tab-pane fade active show"},we={class:"list-group list-group-flush"},Se={class:"list-group-item"},Fe={class:"table table-sm table-borderless device-status-table"},xe={class:"list-group-item"},De={class:"table table-sm table-borderless device-status-table"},Ee={id:"peers",class:"tab-pane fade"},Ne={key:0,class:"list-group list-group-flush"},Ve={class:"list-group-item"},ze={key:1,id:"peerTable",class:"table table-sm"},Le={scope:"col"},Ae={scope:"col"},Oe=e("th",{scope:"col"},null,-1),Be=["onClick"],Me={__name:"UserViewModal",props:{userId:String,visible:Boolean},emits:["close"],setup(t, {emit:l}){const i=t,{t:v}=A(),_=N(),a=U(()=>{let p=_.Find(i.userId);return p||{}}),d=U(()=>i.visible?v("users.view")+": "+a.value.Identifier:""),s=U(()=>_.Peers);O(()=>i.visible,async(p, S)=>{S===!1&&p===!0&&(console.log(a.value),await _.LoadUserPeers(a.value.Identifier))});function b(){l("close")}return(p, S)=>(u(),B(M,{title:n(d),visible:t.visible,onClose:b},{default:x(()=>[Ce,e("div",Ue,[e("div",Ie,[e("ul",we,[e("li",Se,[z(" User Information: "),e("table",Fe,[e("tbody",null,[e("tr",null,[e("td",null,o(p.$t("users.label.email"))+":",1),e("td",null,o(n(a).Email),1)]),e("tr",null,[e("td",null,o(p.$t("users.label.firstname"))+":",1),e("td",null,o(n(a).Firstname),1)]),e("tr",null,[e("td",null,o(p.$t("users.label.lastname"))+":",1),e("td",null,o(n(a).Lastname),1)]),e("tr",null,[e("td",null,o(p.$t("users.label.phone"))+":",1),e("td",null,o(n(a).Phone),1)]),e("tr",null,[e("td",null,o(p.$t("users.label.department"))+":",1),e("td",null,o(n(a).Department),1)])])])]),e("li",xe,[z(" Notes: "),e("table",De,[e("tbody",null,[e("tr",null,[e("td",null,o(n(a).Notes),1)])])])])])]),e("div",Ee,[n(s).length===0?(u(),h("ul",Ne,[e("li",Ve,o(p.$t("users.nopeers.message")),1)])):$("",!0),n(s).length!==0?(u(),h("table",ze,[e("thead",null,[e("tr",null,[e("th",Le,o(p.$t("user.peers.name")),1),e("th",Ae,o(p.$t("user.peers.ips")),1),Oe])]),e("tbody",null,[(u(!0),h(I,null,D(n(s), y=>(u(),h("tr",{key:y.Identifier},[e("td",null,o(y.DisplayName),1),e("td",null,[(u(!0),h(I,null,D(y.Addresses, f=>(u(),h("span",{key:f,class:"badge rounded-pill bg-light"},o(f),1))),128))])]))),128))])])):$("",!0)])])]),footer:x(()=>[e("button",{class:"btn btn-primary",type:"button",onClick:k(b,["prevent"])},"Close",8,Be)]),_:1},8,["title","visible"]))}},Te={class:"mt-4 row"},We={class:"col-12 col-lg-5"},He={class:"col-12 col-lg-4 text-lg-end"},je={class:"form-group d-inline"},qe={class:"input-group mb-3"},Ge=e("button",{class:"input-group-text btn btn-primary",title:"Search"},[e("i",{class:"fa-solid fa-search"})],-1),Ke={class:"col-12 col-lg-3 text-lg-end"},Ye=e("a",{class:"btn btn-primary",href:"#",title:"Send mail to selected users"},[e("i",{class:"fa fa-paper-plane"})],-1),Je=e("i",{class:"fa fa-plus me-1"},null,-1),Qe=e("i",{class:"fa fa-user"},null,-1),Re=[Je,Qe],Xe={class:"mt-2 table-responsive"},Ze={key:0},es={key:1,id:"userTable",class:"table table-sm"},ss=e("th",{scope:"col"},[e("input",{id:"flexCheckDefault",class:"form-check-input",title:"Select all",type:"checkbox",value:""})],-1),ts={scope:"col"},ls={scope:"col"},os={scope:"col"},as={scope:"col"},ns={class:"text-center",scope:"col"},is={class:"text-center",scope:"col"},rs={class:"text-center",scope:"col"},ds=e("th",{scope:"col"},null,-1),cs=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),us={class:"text-center"},hs={class:"badge rounded-pill bg-light"},ps={class:"text-center"},fs={class:"text-center"},ms={key:0,class:"text-danger"},_s=e("i",{class:"fa fa-check-circle"},null,-1),vs=[_s],gs={key:1},bs=e("i",{class:"fa fa-circle-xmark"},null,-1),$s=[bs],ks={class:"text-center"},ys=["onClick"],Ps=e("i",{class:"fa-solid fa-magnifying-glass me-2"},null,-1),Cs=[Ps],Us=["onClick"],Is=e("i",{class:"fas fa-cog me-2"},null,-1),ws=[Is],Ss=e("hr",null,null,-1),Fs={class:"mt-3"},xs={class:"row"},Ds={class:"col-6"},Es={class:"pagination pagination-sm"},Ns=["onClick"],Vs={class:"col-6"},zs={class:"form-group row"},Ls={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},As={class:"col-sm-6"},Os=e("option",{value:"10"},"10",-1),Bs=e("option",{value:"25"},"25",-1),Ms=e("option",{value:"50"},"50",-1),Ts=e("option",{value:"100"},"100",-1),Ws={value:"999999999"},js={__name:"UserView",setup(t){const l=N(),i=E(""),v=E("");W(()=>{l.LoadUsers()});function _(a){a.Source==="db"?i.value=a.Identifier:w({title:"Forbidden",text:"You can not edit this user!",type:"error"})}return(a, d)=>(u(),h(I,null,[L(Pe,{userId:i.value,visible:i.value!=="",onClose:d[0]||(d[0]= s=>i.value="")},null,8,["userId","visible"]),L(Me,{userId:v.value,visible:v.value!=="",onClose:d[1]||(d[1]= s=>v.value="")},null,8,["userId","visible"]),e("div",Te,[e("div",We,[e("h1",null,o(a.$t("user.h1")),1)]),e("div",He,[e("div",je,[e("div",qe,[m(e("input",{"onUpdate:modelValue":d[2]||(d[2]= s=>n(l).filter=s),class:"form-control",placeholder:"Search...",type:"text",onKeyup:d[3]||(d[3]=(...s)=>n(l).afterPageSizeChange&&n(l).afterPageSizeChange(...s))},null,544),[[g,n(l).filter]]),Ge])])]),e("div",Ke,[Ye,e("a",{class:"btn btn-primary ms-2",href:"#",title:"Add a user",onClick:d[4]||(d[4]=k(s=>i.value="#NEW#",["prevent"]))},Re)])]),e("div",Xe,[n(l).Count===0?(u(),h("div",Ze,[e("h4",null,o(a.$t("users.noUsers.h4")),1),e("p",null,o(a.$t("users.noUsers.message")),1)])):$("",!0),n(l).Count!==0?(u(),h("table",es,[e("thead",null,[e("tr",null,[ss,e("th",ts,o(a.$t("user.id")),1),e("th",ls,o(a.$t("user.email")),1),e("th",os,o(a.$t("user.firstname")),1),e("th",as,o(a.$t("user.lastname")),1),e("th",ns,o(a.$t("user.source")),1),e("th",is,o(a.$t("user.peers")),1),e("th",rs,o(a.$t("user.admin")),1),ds])]),e("tbody",null,[(u(!0),h(I,null,D(n(l).FilteredAndPaged, s=>(u(),h("tr",{key:s.Identifier},[cs,e("td",null,o(s.Identifier),1),e("td",null,o(s.Email),1),e("td",null,o(s.Firstname),1),e("td",null,o(s.Lastname),1),e("td",us,[e("span",hs,o(s.Source),1)]),e("td",ps,o(s.PeerCount),1),e("td",fs,[s.IsAdmin?(u(),h("span",ms,vs)):(u(),h("span",gs,$s))]),e("td",ks,[e("a",{href:"#",title:"Show user",onClick:k(b=>v.value=s.Identifier,["prevent"])},Cs,8,ys),e("a",{class:F({disabled:s.Source!=="db"}),href:"#",title:"Edit user",onClick:k(b=>_(s),["prevent"])},ws,10,Us)])]))),128))])])):$("",!0)]),Ss,e("div",Fs,[e("div",xs,[e("div",Ds,[e("ul",Es,[e("li",{class:F([{disabled:n(l).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:d[5]||(d[5]=(...s)=>n(l).previousPage&&n(l).previousPage(...s))},"«")],2),(u(!0),h(I,null,D(n(l).pages, s=>(u(),h("li",{key:s,class:F([{active:n(l).currentPage===s},"page-item"])},[e("a",{class:"page-link",onClick: b=>n(l).gotoPage(s)},o(s),9,Ns)],2))),128)),e("li",{class:F([{disabled:!n(l).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:d[6]||(d[6]=(...s)=>n(l).nextPage&&n(l).nextPage(...s))},"»")],2)])]),e("div",Vs,[e("div",zs,[e("label",Ls,o(a.$t("interfaces.pagination.size"))+":",1),e("div",As,[m(e("select",{"onUpdate:modelValue":d[7]||(d[7]= s=>n(l).pageSize=s),class:"form-select",onClick:d[8]||(d[8]= s=>n(l).afterPageSizeChange())},[Os,Bs,Ms,Ts,e("option",Ws,o(a.$t("interfaces.pagination.all")),1)],512),[[H,n(l).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{js as default};
