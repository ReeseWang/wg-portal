import{d as $,z as F,B as p,a as g,b as _,A as v,r as C,p as I,o as l,h as o,q as x,C as z,g as e,t as r,i as y,v as w,s as a,l as P,j as h,F as f,n as m,x as b,y as E,m as O}from"./index-01f1dd15.js";const k="/user",U=$({id:"profile",state:()=>({peers:[],stats:{},statsEnabled:!1,user:{},filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{FindPeers:t=>s=>t.peers.find(c=>c.Identifier===s),CountPeers:t=>t.peers.length,FilteredPeerCount:t=>t.FilteredPeers.length,Peers:t=>t.peers,FilteredPeers:t=>t.filter?t.peers.filter(s=>s.DisplayName.includes(t.filter)||s.Identifier.includes(t.filter)):t.peers,FilteredAndPagedPeers:t=>t.FilteredPeers.slice(t.pageOffset,t.pageOffset+t.pageSize),isFetching:t=>t.fetching,hasNextPage:t=>t.pageOffset<t.FilteredPeerCount-t.pageSize,hasPrevPage:t=>t.pageOffset>0,currentPage:t=>t.pageOffset/t.pageSize+1,Statistics:t=>s=>t.statsEnabled&&s in t.stats?t.stats[s]:F(),hasStatistics:t=>t.statsEnabled},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let t=1;this.pages=[];for(let s=0;s<this.FilteredPeerCount;s+=this.pageSize)this.pages.push(t++)},gotoPage(t){this.pageOffset=(t-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setPeers(t){this.peers=t,this.fetching=!1},setUser(t){this.user=t,this.fetching=!1},setStats(t){t||(this.stats={},this.statsEnabled=!1),this.stats=t.Stats,this.statsEnabled=t.Enabled},async LoadPeers(){this.fetching=!0;let t=p().user.Identifier;return g.get(`${k}/${_(t)}/peers`).then(this.setPeers).catch(s=>{this.setPeers([]),console.log("Failed to load user peers for ",t,": ",s),v({title:"Backend Connection Failure",text:"Failed to load user peers!"})})},async LoadStats(){this.fetching=!0;let t=p().user.Identifier;return g.get(`${k}/${_(t)}/stats`).then(this.setStats).catch(s=>{this.setStats(void 0),console.log("Failed to load peer stats: ",s),v({title:"Backend Connection Failure",text:"Failed to load peer stats!"})})},async LoadUser(){this.fetching=!0;let t=p().user.Identifier;return g.get(`${k}/${_(t)}`).then(this.setUser).catch(s=>{this.setUser({}),console.log("Failed to load user for ",t,": ",s),v({title:"Backend Connection Failure",text:"Failed to load user!"})})}}}),D={class:"mt-4 row"},N={class:"col-12 col-lg-5"},L={class:"mt-2"},A={class:"col-12 col-lg-4 text-lg-end"},B={class:"form-group d-inline"},V={class:"input-group mb-3"},H=e("button",{class:"input-group-text btn btn-primary",title:"Search"},[e("i",{class:"fa-solid fa-search"})],-1),M={class:"col-12 col-lg-3 text-lg-end"},T=e("i",{class:"fa fa-plus me-1"},null,-1),W=e("i",{class:"fa fa-user"},null,-1),j=[T,W],q={class:"mt-2 table-responsive"},K={key:0},G={key:1,id:"peerTable",class:"table table-sm"},J=e("th",{scope:"col"},[e("input",{id:"flexCheckDefault",class:"form-check-input",title:"Select all",type:"checkbox",value:""})],-1),Q=e("th",{scope:"col"},null,-1),X={scope:"col"},Y={scope:"col"},Z={key:0,scope:"col"},R={scope:"col"},ee=e("th",{scope:"col"},null,-1),te=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),se={class:"text-center"},ie={key:0,class:"text-danger"},ae=["title"],le={key:1,class:"text-warning"},oe=["title"],ne=["title"],re=["title"],de={key:0},ce={key:0},he=e("span",{class:"badge rounded-pill bg-success"},[e("i",{class:"fa-solid fa-link"})],-1),ue=["title"],fe={key:1},pe=e("span",{class:"badge rounded-pill bg-light"},[e("i",{class:"fa-solid fa-link-slash"})],-1),ge=[pe],_e={class:"text-center"},ve=["onClick"],Pe=e("i",{class:"fas fa-eye me-2"},null,-1),me=[Pe],be=["onClick"],ke=e("i",{class:"fas fa-cog"},null,-1),Se=[ke],Ce=e("hr",null,null,-1),ye={class:"mt-3"},$e={class:"row"},Fe={class:"col-6"},Ie={class:"pagination pagination-sm"},xe=["onClick"],ze={class:"col-6"},we={class:"form-group row"},Ee={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},Oe={class:"col-sm-6"},Ue=e("option",{value:"10"},"10",-1),De=e("option",{value:"25"},"25",-1),Ne=e("option",{value:"50"},"50",-1),Le=e("option",{value:"100"},"100",-1),Ae={value:"999999999"},Ve={__name:"ProfileView",setup(t){const s=U(),c=C(""),S=C("");return I(async()=>{await s.LoadUser(),await s.LoadPeers(),await s.LoadStats()}),(d,n)=>(l(),o(f,null,[x(z,{peerId:c.value,visible:c.value!=="",onClose:n[0]||(n[0]=i=>c.value="")},null,8,["peerId","visible"]),e("div",D,[e("div",N,[e("h2",L,r(d.$t("profile.h2-clients")),1)]),e("div",A,[e("div",B,[e("div",V,[y(e("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>a(s).filter=i),class:"form-control",placeholder:"Search...",type:"text",onKeyup:n[2]||(n[2]=(...i)=>a(s).afterPageSizeChange&&a(s).afterPageSizeChange(...i))},null,544),[[w,a(s).filter]]),H])])]),e("div",M,[e("a",{class:"btn btn-primary ms-2",href:"#",title:"Add a peer",onClick:n[3]||(n[3]=P(i=>S.value="#NEW#",["prevent"]))},j)])]),e("div",q,[a(s).CountPeers===0?(l(),o("div",K,[e("h4",null,r(d.$t("profile.noPeerSelect.h4")),1),e("p",null,r(d.$t("profile.noPeerSelect.message")),1)])):h("",!0),a(s).CountPeers!==0?(l(),o("table",G,[e("thead",null,[e("tr",null,[J,Q,e("th",X,r(d.$t("profile.tableHeadings.name")),1),e("th",Y,r(d.$t("profile.tableHeadings.ip")),1),a(s).hasStatistics?(l(),o("th",Z,r(d.$t("profile.tableHeadings.stats")),1)):h("",!0),e("th",R,r(d.$t("profile.tableHeadings.interface")),1),ee])]),e("tbody",null,[(l(!0),o(f,null,m(a(s).FilteredAndPagedPeers,i=>(l(),o("tr",{key:i.Identifier},[te,e("td",se,[i.Disabled?(l(),o("span",ie,[e("i",{class:"fa fa-circle-xmark",title:i.DisabledReason},null,8,ae)])):h("",!0),!i.Disabled&&i.ExpiresAt?(l(),o("span",le,[e("i",{class:"fas fa-hourglass-end",title:i.ExpiresAt},null,8,oe)])):h("",!0)]),e("td",null,[i.DisplayName?(l(),o("span",{key:0,title:i.Identifier},r(i.DisplayName),9,ne)):(l(),o("span",{key:1,title:i.Identifier},r(d.$filters.truncate(i.Identifier,10)),9,re))]),e("td",null,[(l(!0),o(f,null,m(i.Addresses,u=>(l(),o("span",{key:u,class:"badge rounded-pill bg-light"},r(u),1))),128))]),a(s).hasStatistics?(l(),o("td",de,[a(s).Statistics(i.Identifier).IsConnected?(l(),o("div",ce,[he,O(),e("span",{title:d.peers.Statistics(i.Identifier).LastHandshake},"Connected",8,ue)])):(l(),o("div",fe,ge))])):h("",!0),e("td",null,r(i.InterfaceIdentifier),1),e("td",_e,[e("a",{href:"#",title:"Show peer",onClick:P(u=>c.value=i.Identifier,["prevent"])},me,8,ve),e("a",{href:"#",title:"Edit peer",onClick:P(u=>S.value=i.Identifier,["prevent"])},Se,8,be)])]))),128))])])):h("",!0)]),Ce,e("div",ye,[e("div",$e,[e("div",Fe,[e("ul",Ie,[e("li",{class:b([{disabled:a(s).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:n[4]||(n[4]=(...i)=>a(s).previousPage&&a(s).previousPage(...i))},"«")],2),(l(!0),o(f,null,m(a(s).pages,i=>(l(),o("li",{key:i,class:b([{active:a(s).currentPage===i},"page-item"])},[e("a",{class:"page-link",onClick:u=>a(s).gotoPage(i)},r(i),9,xe)],2))),128)),e("li",{class:b([{disabled:!a(s).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:n[5]||(n[5]=(...i)=>a(s).nextPage&&a(s).nextPage(...i))},"»")],2)])]),e("div",ze,[e("div",we,[e("label",Ee,r(d.$t("general.pagination.size"))+":",1),e("div",Oe,[y(e("select",{"onUpdate:modelValue":n[6]||(n[6]=i=>a(s).pageSize=i),class:"form-select",onClick:n[7]||(n[7]=i=>a(s).afterPageSizeChange())},[Ue,De,Ne,Le,e("option",Ae,r(d.$t("general.pagination.all")),1)],512),[[E,a(s).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{Ve as default};
